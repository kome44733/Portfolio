<div class="container">
  <div class="main">
    <table class = "table">
      <thead class ="table-dark">
        <tr>
          <th>質問</th>
          <% if customer_signed_in? %>
          <th id="favorite_btn_<%= @question.id %>"class= "text-right"class= "text-white">
            <%= render 'public/favorites/favorite-btn',question: @question %>
          </th>
          <% end %>
        </tr>
      </thead>
      <tbody>
        <tr class ="border">
          <td colspan = "2">
            <%= simple_format(@question.customer.nickname+"さん") %>
            <%= simple_format(@question.post) %>
            <% if customer_signed_in? && (@question.customer_id != current_customer.id && @answer_count <= 0) %>
              <%= form_with model:[@question,@answer],method: :post do |f| %>
                <% if @question.best_answer_id.nil? %>
                  <%= f.text_area :answer,placeholder:"回答を入力してください",class: "form-control" %>
                  <%= f.submit "送信する"%>
                <% end %>
              <% end %>
            <% end %>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="main">
    <% @question.answers.each do |answer| %>
      <table class = "table">
            <% if answer.question.best_answer_id == answer.id %>
        <thead class ="table-success">
          <tr>
            <td><span class= "pr-3">回答</span><%= (answer.customer.nickname+"さん""ベストアンサーに選ばれました")%>
            <% else %>
        <thead class ="table-dark">
          <tr>
            <td><span class= "pr-3">回答</span><%= answer.customer.nickname+"さん" %>
            <% end %>
            </td>
            <td class ="text-right">
              <% if customer_signed_in? && (@question.customer_id == current_customer.id && @question.best_answer_id.nil?) %>
                <%= form_with model: @question, local: true do |form| %>
                  <%= form.hidden_field :best_answer_id, value: answer.id %>
                  <%= form.submit 'ベストアンサー', data: {confirm: "ベストアンサーに選択すると投稿に回答、返信ができなくなります。それでもよろしいですか？"}%>
                <% end %>
              <% end %>
            </td>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class ="border" colspan = "2">
              <div class="border">
                <%= simple_format(answer.customer.nickname+"さん") %>
                <p class= "text-break"><%= simple_format(answer.answer) %></p>
                <% if @question.best_answer_id.nil? && customer_signed_in? && (answer.customer_id == current_customer.id) %>
                  <div class="col-12 text-right py-1" >
                    <%= link_to question_answer_path(@question,answer), method: :delete, data: {confirm: "返信された削除しますか？"} do %>
                      <i class="fas fa-trash h4" style="color:#707070"></i>
                    <% end %>
                  </div>
                <% end %>
              </div>

              <% answer.replies.each do |reply| %>
              <div class="border-bottom">
                <%= simple_format(reply.customer.nickname+"さん") %>
                <%= simple_format(reply.reply) %>
                <% if @question.best_answer_id.nil? && customer_signed_in? && (reply.customer_id == current_customer.id) %>
                  <div class="col-12 text-right py-1">
                    <%= link_to question_answer_reply_path(@question,reply.answer_id,reply.id), method: :delete, data: {confirm: "削除しますか？"} do %>
                      <i class="fas fa-trash h4" style="color:#707070"></i>
                    <% end %>
                  </div>
                <% end %>
              </div>
              <% end %>
              <%= form_with model: @reply, url: question_answer_replies_path(@question, answer), method: :post do |f| %>
                <% if customer_signed_in? && (answer.customer_id == current_customer.id || @question.customer_id == current_customer.id) && @question.best_answer_id.nil? %>
                  <%= f.text_area :reply,placeholder:"返信を入力してください",class: "form-control" %>
                  <%= f.submit "送信する"%>
                <% end %>
              <% end %>
            </td>
          </tr>
        </tbody>
      </table>
    <% end %>
  </div>

