<div class="container">
  <div class="main">
    <table class = "table">
      <thead class ="table-dark">
        <tr>
          <th>質問</th>
          <th id="favorite_btn_<%= @question.id %>">
            <%= render 'public/favorites/favorite-btn',question: @question %>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr class ="border">
          <td>
            <%= simple_format(@question.customer.nickname+"さん") %>
            <%= simple_format(@question.post) %>
            <% if @question.customer_id != current_customer.id && @answer_count <= 0 %>
              <%= form_with model:[@question,@answer],method: :post do |f| %>
                <% if @question.best_answer_id.nil? %>
                  <%= f.text_area :answer %>
                  <%= f.submit %>
                <% end %>
              <% end %>
            <% end %>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="main">
    <% @question.answers.each do |answer| %>
    <table class = "table">
          <% if answer.question.best_answer_id == answer.id %>
      <thead class ="table-success">
        <tr>
          <td>回答<%= (answer.customer.nickname+"さん""ベストアンサーに選ばれました") %>
          <% else %>
      <thead class ="table-dark">
        <tr>
          <td>回答<%= answer.customer.nickname+"さん" %>
          <% end %>
            <% if @question.customer_id == current_customer.id && @question.best_answer_id.nil? %>
              <%= form_with model: @question, local: true do |form| %>
                <%= form.hidden_field :best_answer_id, value: answer.id %>
                <%= form.submit 'ベストアンサー'%>
              <% end %>
            <% end %>
          </td>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class ="border">
            <div class="border">

            <%= simple_format(answer.customer.nickname+"さん") %>
            <%= simple_format(answer.answer) %>


            </div>
            <% answer.replies.each do |reply| %>
              <%= simple_format(reply.customer.nickname+"さん") %>
              <%= simple_format(reply.reply) %>
            <% end %>
            <%= form_with model: @reply, url: question_answer_replies_path(@question, answer), method: :post do |f| %>
              <% if (answer.customer_id == current_customer.id || @question.customer_id == current_customer.id) &&  @question.best_answer_id.nil? %>
                <%= f.text_area :reply %>
                <%= f.submit %>
              <% end %>
            <% end %>
          </td>
        </tr>
      </tbody>
    </table>
    <% end %>
  </div>

  <p class="reply-show btn btn-warning">返信を見る</p>
  <div class="replies">
  </div>
</div>